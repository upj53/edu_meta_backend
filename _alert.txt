블로그에 있는 이상한거 따라하지 않기
https://streamls.tistory.com/entry/FastAPI-MySQL-CRUD-1#google_vignette
이거 따라하다가 하루 날라갔다 
'''
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
https://upj53.run.goorm.io
https://upj53-test.run.goorm.io

Jinja2 템플릿 적용
FastAPI
https://fastapi.tiangolo.com/tutorial/first-steps/
'''
from fastapi import FastAPI, Form, Request, File, UploadFile
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
from starlette.responses import RedirectResponse
from typing import Union, List, Set
from pydantic import BaseModel, HttpUrl
from db.db import session
app = FastAPI()
templages = Jinja2Templates(directory='./templages')

# 전체 리스트
@app.get('/users')
async def read_users(request: Request):
  context = {}
  users = session.query(UserTable).all()

  context['request']
  context['users'] = users
  
  return templages.TemplateResponse('user_list.html', context)

# 특정 사람 보기
@app.get('/users/{user_id}')
async def read_user(request: Request):
  context = {}
  user = session.query(UserTable).filter(UserTable.id == user_id).first()

  context['request'] = request
  context['name'] = user.name 
  context['age'] = user.age 

  return templates.TemplateResponse('user_list.html', context)

# 사람 정보 생성
@app.post('/user')
async def create_user(name:str=Form(...), age:int=Form(...)):
  print(name, age)
  user = UserTable()
  user.name = name 
  user.age = age 

  session.add(user)
  session.commit()

  return RedirectResponse(url='/users', status_code=302)

# 사람 정보 수정
@app.post('/users')
async def update_user(user_id:int=Form(...), n_name:str=Form(...), n_age:int=Form(...)):
  print(n_name, n_age)
  user = session.query(UserTable).filter(UserTable.id == user_id).first()
  user.name = n_name 
  user.age = n_age 
  session.commit()

  return RedirectResponse(url='/users', status_code=302)

# 사람 정보 삭제
@app.post('/delete/{user_id}')
async def delete_users(request: Request, user_id:int):
  print('delete ', user_id)
  session.query(UserTable).filter(UserTable.id == user_id).delete()
  session.commit()

  return RedirectResponse(url='/users', status_code=302)